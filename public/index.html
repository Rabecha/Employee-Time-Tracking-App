<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Time Tracking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#f6f7fb;
            --card:#ffffff;
            --muted:#6c757d;
            --accent:#0d6efd;
            --glass: rgba(255,255,255,0.7);
        }
        body{font-family:'Inter',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);}
        .hero{padding:48px 0 24px;text-align:center}
        .brand-badge{width:72px;height:72px;border-radius:18px;background:linear-gradient(135deg,#0d6efd,#6f42c1);display:inline-flex;align-items:center;justify-content:center;color:#fff;font-size:28px;box-shadow:0 8px 20px rgba(13,110,253,.12)}
        .main-card{background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,250,0.9));border:0;border-radius:12px;box-shadow:0 8px 30px rgba(20,20,50,.06);overflow:hidden}
        .form-control:focus{box-shadow:0 0 0 .2rem rgba(13,110,253,.12)}
        .btn-accent{background:var(--accent);border:none}
        .entry-card{border-radius:10px;box-shadow:0 6px 18px rgba(20,20,50,.04)}
        .empty-state{padding:48px 0;color:var(--muted)}
        @media (min-width:992px){
            .grid-split{display:grid;grid-template-columns:420px 1fr;gap:24px}
        }
    </style>
</head>
<body>
    <header class="hero">
        <div class="container">
            <div class="brand-badge mx-auto mb-3"><i class="fas fa-clock"></i></div>
            <h1 class="h2 fw-bold mb-1">Employee Time Tracking</h1>
            <p class="text-muted mb-0">Quickly log hours, track check-ins and check-outs, and review work time at a glance.</p>
        </div>
    </header>

    <main class="container mb-5">
        <div class="main-card p-4">
            <div class="grid-split">
                <!-- Left: Form -->
                <section class="p-3">
                    <h4 class="mb-3">Log Work Hours</h4>
                    <form id="timeForm" class="mb-3">
                        <div class="mb-3">
                            <label for="employeeName" class="form-label small">Employee Name</label>
                            <input type="text" class="form-control" id="employeeName" placeholder="Enter employee name" required>
                        </div>
                        <div class="mb-3">
                            <label for="checkInTime" class="form-label small">Check-In</label>
                            <input type="datetime-local" class="form-control" id="checkInTime" required>
                        </div>
                        <div class="mb-3">
                            <label for="checkOutTime" class="form-label small">Check-Out</label>
                            <input type="datetime-local" class="form-control" id="checkOutTime" required>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-accent text-white px-4">
                                <i class="fas fa-plus me-2"></i> Log Hours
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                                <i class="fas fa-eraser me-1"></i> Reset
                            </button>
                        </div>
                    </form>

                    <div class="small text-muted mt-3">Tip: Use the date/time picker to log precise check-in and check-out times.</div>
                </section>

                <!-- Right: Entries -->
                <section class="p-3 border-start">
                    <div id="timesList">
                        <div class="empty-state text-center">
                            <p class="mb-2"><strong>No time entries yet.</strong></p>
                            <p class="mb-0">Log your first hours using the form on the left.</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Preserve existing JS logic; interacts with IDs: timeForm, timesList, employeeName, checkInTime, checkOutTime
        let editingEntryId = null;

        document.addEventListener('DOMContentLoaded', loadTimeEntries);

        document.getElementById('timeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const employeeName = document.getElementById('employeeName').value;
            const checkInTime = document.getElementById('checkInTime').value;
            const checkOutTime = document.getElementById('checkOutTime').value;
            
            if (editingEntryId) {
                await updateTimeEntry(editingEntryId, employeeName, checkInTime, checkOutTime);
            } else {
                await createTimeEntry(employeeName, checkInTime, checkOutTime);
            }
            
            resetForm();
            loadTimeEntries();
        });

        async function loadTimeEntries() {
            try {
                const response = await fetch('/api/timesheets');
                const entries = await response.json();
                displayTimeEntries(entries);
            } catch (error) {
                console.error('Error loading time entries:', error);
            }
        }

        function displayTimeEntries(entries) {
            const timesList = document.getElementById('timesList');
            
            if (!entries || entries.length === 0) {
                timesList.innerHTML = `
                    <div class="empty-state text-center">
                        <p class="mb-2"><strong>No time entries yet.</strong></p>
                        <p class="mb-0">Log your first hours using the form on the left.</p>
                    </div>
                `;
                return;
            }

            timesList.innerHTML = entries.map(entry => {
                const checkIn = new Date(entry.check_in_time);
                const checkOut = new Date(entry.check_out_time);
                const hoursWorked = ((checkOut - checkIn) / (1000 * 60 * 60)).toFixed(2);

                return `
                    <div class="entry-card mb-3 p-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h5 class="mb-1">${entry.employee_name}</h5>
                                <div class="text-muted small">${checkIn.toLocaleString()} â†’ ${checkOut.toLocaleString()}</div>
                            </div>
                            <div class="text-end">
                                <div class="badge bg-light text-secondary mb-2">${hoursWorked} h</div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editEntry(${entry.id}, '${entry.employee_name}', '${entry.check_in_time}', '${entry.check_out_time}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteEntry(${entry.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="text-muted small mt-2">Logged: ${new Date(entry.created_at).toLocaleString()}</div>
                    </div>
                `;
            }).join('');
        }

        async function createTimeEntry(employeeName, checkInTime, checkOutTime) {
            try {
                const response = await fetch('/api/timesheets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        employee_name: employeeName, 
                        check_in_time: checkInTime,
                        check_out_time: checkOutTime
                    }),
                });
                
                if (response.ok) {
                    showAlert('Time entry logged successfully!', 'success');
                } else {
                    showAlert('Failed to log time entry', 'danger');
                }
            } catch (error) {
                showAlert('Error logging time entry', 'danger');
                console.error('Error creating time entry:', error);
            }
        }

        async function updateTimeEntry(id, employeeName, checkInTime, checkOutTime) {
            try {
                const response = await fetch(`/api/timesheets/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        employee_name: employeeName, 
                        check_in_time: checkInTime,
                        check_out_time: checkOutTime
                    }),
                });
                
                if (response.ok) {
                    showAlert('Time entry updated successfully!', 'success');
                } else {
                    showAlert('Failed to update entry', 'danger');
                }
            } catch (error) {
                showAlert('Error updating time entry', 'danger');
                console.error('Error updating time entry:', error);
            }
        }

        async function deleteEntry(id) {
            if (confirm('Are you sure you want to delete this time entry?')) {
                try {
                    const response = await fetch(`/api/timesheets/${id}`, {
                        method: 'DELETE',
                    });
                    
                    if (response.ok) {
                        showAlert('Time entry deleted successfully!', 'success');
                        loadTimeEntries();
                    } else {
                        showAlert('Failed to delete entry', 'danger');
                    }
                } catch (error) {
                    showAlert('Error deleting time entry', 'danger');
                    console.error('Error deleting time entry:', error);
                }
            }
        }

        function editEntry(id, employeeName, checkInTime, checkOutTime) {
            document.getElementById('employeeName').value = employeeName;
            document.getElementById('checkInTime').value = checkInTime;
            document.getElementById('checkOutTime').value = checkOutTime;
            editingEntryId = id;
            
            document.querySelector('#timeForm button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Update Entry';
        }

        function resetForm() {
            document.getElementById('timeForm').reset();
            editingEntryId = null;
            document.querySelector('#timeForm button[type="submit"]').innerHTML = '<i class="fas fa-plus"></i> Log Hours';
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.querySelector('main.container')?.prepend(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
